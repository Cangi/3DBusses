<html>
<head>
<script src="https://cdn-webgl.wrld3d.com/wrldjs/dist/latest/wrld.js"></script>
<script src="busRoutes.js"></script>
<script src="busStopList.js"></script>
<script src="https://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.1/leaflet.css" rel="stylesheet" />
<link rel="stylesheet" href="testcss.css">

</head>
<body>

	<div style="position: relative">
		<div id="map" style="height: 100%"></div>		
			<script>
			let routes = {};
			//create map 
			var map = L.Wrld.map("map", "c976700dbe05df6d18bdab38af2b1ae2", {center: [56.458522, -2.97107], zoom: 15});
						
			// create custom icon
    		var BusStop = L.Icon.extend({
    		options: {
        		iconSize:     [75, 75],
        		iconAnchor:   [32.5, 75],
        		popupAnchor:  [-3, -76]
    			}
			});

			//links to images used for stops
			var linkBusStop = 'https://cdn.iconscout.com/icon/premium/png-512-thumb/bus-stop-10-660162.png'
			var linkBusStation = 'https://cdn2.iconfinder.com/data/icons/large-home-icons/512/Bus_station_transportation_space.png'

			var stop1 = new BusStop({iconUrl: linkBusStop});
			var stopBusStation = new BusStop({iconUrl: linkBusStation});
    
    		L.icon = function (options) {
    			return new L.Icon(options);
			};
			
			var stopsArray = []
			var stationsArray = []
			
			//Open schedule when a bus stop/station is clicked
			function newWindow() {
			
				var myWindow;
    			var width = 400;
    			var height = 300;
    			var left = parseInt((screen.availWidth/2) - (width/2));
    			var top = parseInt((screen.availHeight/2) - (height/2));
    			var windowFeatures = "width=" + width + ",height=" + height + ",status,resizable,left=" + left + ",top=" + top;
    				
				myWindow = window.open("", "", windowFeatures);
				myWindow.document.write('Schedule');
			
			}

			//Add bus stops
			for (i = 0; i < locations.length; i++) {  
				
				var stops = L.marker([locations[i][0], locations[i][1]], {icon: stop1}).on('click', function() {newWindow()});
				
				stopsArray[i] = stops
		
      		};
      		
      		//Add bus stations
      		for (i = 0; i < locationBusStations.length; i++) {  
	
        		var stations = L.marker([locationBusStations[i][0], locationBusStations[i][1]], {icon: stopBusStation}).on('click', function(){newWindow()});
        		stationsArray[i] = stations
      		};
      		
      		//Hide  BUS STOPS markers when zoomed out
      		var stopMarkers = new L.FeatureGroup();
      		
      		for (i = 0; i < locations.length; i++) {
      		
      			stopMarkers.addLayer(stopsArray[i]);
      		 }
      		
      		map.addLayer(stopMarkers); // Add markers the first time the page is loaded
      		map.on('zoomend', function() {
    			if (map.getZoom() < 14){
            		map.removeLayer(stopMarkers);
    				}
    				else {
            		map.addLayer(stopMarkers);
        			}
			});
			
			//Hide  BUS STATIONS markers when zoomed out
			var stationMarkers = new L.FeatureGroup();
      		
      		for (i = 0; i < locationBusStations.length; i++) {
      		
      			stationMarkers.addLayer(stationsArray[i]);
      		 }
      		 
      		map.addLayer(stationMarkers); // Add markers the first time the page is loaded
      		map.on('zoomend', function() {
    			if (map.getZoom() < 14){
            		map.removeLayer(stationMarkers);
    				}
    				else {
            		map.addLayer(stationMarkers);
        			}
			});
						
			function getRoute(x)
			{
				var busNumber = x;
				$.get({
					url: "/getBusStops",
					data : {busNumber : x},
					success : function(json) {
						routes[x] = json[0].route;				
						var bus = L.polyline(routes[x], {color: getRandomColor(), className: 'BusOptions'}).addTo(map);
						
						function OnBusClick() {
							alert("This is route : " + x);
						}
						bus.on('click', L.bind(OnBusClick, null, x));
						
										
				
		
					}
				})
			}
			
			//creates each route
			var numberOneBus = getRoute(1);
			var numberFourBus = getRoute(4);
			var numberFiveBus = getRoute(5);
			var numberTwentyThreeSBus = getRoute(23);
			var numberThirtyTwoBus = getRoute(32);
			
			function getRandomColor() {
				var color = '#'; // hexadecimal starting symbol
                var letters = ['ef0b0b','ef670b','1bc415','26e2c0','9c73dd','ff1c63', '291A6D', '3B552E', '922C2C', '82244D', 'B62222', '2B781F', '85B87D', 'E9E43D', 'DD832F', '9F7676', '1D2FB2', 'efd809', '00705d', '004570', '310449', 'b7005b']; //Set your colors here
                color += letters[Math.floor(Math.random() * letters.length)];
				return color;
			}

			
			</script>		
		</div>
	</div>
</body>
</html>